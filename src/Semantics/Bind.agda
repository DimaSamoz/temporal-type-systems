{-# OPTIONS --allow-unsolved-metas #-}
module Semantics.Bind where

open import Syntax.Types
open import Syntax.Context renaming (_,_ to _,,_)
open import Syntax.Terms
open import Syntax.Substitution.Kits
open import Syntax.Substitution.Instances
open import Syntax.Substitution.Lemmas

open import Semantics.Types
open import Semantics.Terms
open import Semantics.Context
open import Semantics.Substitution.Kits
open import Semantics.Substitution.Traversal
open import Semantics.Substitution.Instances

open import CategoryTheory.Categories using (Category ; ext)
open import CategoryTheory.Functor
open import CategoryTheory.NatTrans
open import CategoryTheory.Monad
open import CategoryTheory.Comonad
open import CategoryTheory.CartesianStrength
open import CategoryTheory.Instances.Reactive renaming (top to âŠ¤)
open import TemporalOps.Diamond
open import TemporalOps.Delay
open import TemporalOps.Box
open import TemporalOps.OtherOps
open import TemporalOps.StrongMonad

open import Data.Sum
open import Data.Product using (_,_)
open import Relation.Binary.PropositionalEquality as â‰¡
    using (_â‰¡_ ; refl ; sym ; trans ; cong ; congâ‚‚ ; subst)

open â‰¡.â‰¡-Reasoning
open import Holes.Term using (âŒ_âŒŸ)
open import Holes.Cong.Propositional

open Comonad W-â–¡
open Monad M-â—‡
private module F-â—‡ = Functor F-â—‡
private module F-â–¡ = Functor F-â–¡
open Functor F-â–¡ renaming (fmap to â–¡-f)
open Functor F-â—‡ renaming (fmap to â—‡-f)
private module â–¹áµ-C k = CartesianFunctor (F-cart-delay k)
private module â–¹áµ-F k = Functor (F-delay k)
private module â–¡-â–¹áµ k = _âŸ¹_ (â–¡-to-â–¹áµ k)


bind-to->>= : âˆ€ Î“ {âŸ¦AâŸ§ âŸ¦BâŸ§} -> (âŸ¦EâŸ§ : âŸ¦ Î“ âŸ§â‚“ â‡´ â—‡ âŸ¦AâŸ§) (âŸ¦CâŸ§ : âŸ¦ Î“ Ë¢ âŸ§â‚“ âŠ— âŸ¦AâŸ§ â‡´ â—‡ âŸ¦BâŸ§)
        -> (n : â„•) (âŸ¦Î“âŸ§ : âŸ¦ Î“ âŸ§â‚“ n)
        -> bindEvent Î“ âŸ¦EâŸ§ âŸ¦CâŸ§ n âŸ¦Î“âŸ§
        â‰¡ (âŸ¦EâŸ§ n âŸ¦Î“âŸ§ >>= Î» l âŸ¦AâŸ§ â†’ âŸ¦CâŸ§ l (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ l , âŸ¦AâŸ§))
bind-to->>= Î“ {âŸ¦AâŸ§} {âŸ¦BâŸ§} âŸ¦EâŸ§ âŸ¦CâŸ§ n âŸ¦Î“âŸ§ =
    begin
        bindEvent Î“ âŸ¦EâŸ§ âŸ¦CâŸ§ n âŸ¦Î“âŸ§
    â‰¡âŸ¨âŸ©
        Î¼.at âŸ¦BâŸ§ n (F-â—‡.fmap (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦AâŸ§ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§)))
    â‰¡âŸ¨ cong (Î¼.at âŸ¦BâŸ§ n) (lemma (âŸ¦EâŸ§ n âŸ¦Î“âŸ§)) âŸ©
        Î¼.at âŸ¦BâŸ§ n (F-â—‡.fmap (âŸ¦CâŸ§ âˆ˜ âŸ¨ (Î» l _ â†’ âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ l) , id âŸ©) n (âŸ¦EâŸ§ n âŸ¦Î“âŸ§))
    â‰¡âŸ¨âŸ©
        (âŸ¦EâŸ§ n âŸ¦Î“âŸ§ >>= (Î» l âŸ¦AâŸ§ â†’ âŸ¦CâŸ§ l (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ l , âŸ¦AâŸ§)))
    âˆ
    where
    lemma : âˆ€ â—‡âŸ¦AâŸ§
         -> F-â—‡.fmap (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦AâŸ§ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦AâŸ§))
          â‰¡ F-â—‡.fmap (âŸ¦CâŸ§ âˆ˜ âŸ¨ (Î» l _ â†’ âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ l) , id âŸ©) n â—‡âŸ¦AâŸ§
    lemma (k , a) =
        begin
            F-â—‡.fmap (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦AâŸ§ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , (k , a)))
        â‰¡âŸ¨âŸ©
            k , â–¹áµ-F.fmap k (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
                (â–¹áµ-C.m k (â–¡ âŸ¦ Î“ Ë¢ âŸ§â‚“) âŸ¦AâŸ§ n (â–¡-â–¹áµ.at k (â–¡ âŸ¦ Î“ Ë¢ âŸ§â‚“) n (Î´.at âŸ¦ Î“ Ë¢ âŸ§â‚“ k (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§)) , a))
        â‰¡âŸ¨ {!   !} âŸ©
            k , â–¹áµ-F.fmap k (âŸ¦CâŸ§ âˆ˜ âŸ¨ (Î» l _ â†’ âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ l) , id âŸ©) n a
        â‰¡âŸ¨âŸ©
            F-â—‡.fmap (âŸ¦CâŸ§ âˆ˜ âŸ¨ (Î» l _ â†’ âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ l) , id âŸ©) n (k , a)
        âˆ
        where


-- -- Helper function for interpreting bound events
-- bindEvent : âˆ€ Î“ {âŸ¦AâŸ§ âŸ¦BâŸ§} -> (âŸ¦EâŸ§ : âŸ¦ Î“ âŸ§â‚“ â‡´ â—‡ âŸ¦AâŸ§) (âŸ¦CâŸ§ : âŸ¦ Î“ Ë¢ âŸ§â‚“ âŠ— âŸ¦AâŸ§ â‡´ â—‡ âŸ¦BâŸ§)
--               -> (âŸ¦ Î“ âŸ§â‚“ â‡´ â—‡ âŸ¦BâŸ§)
-- bindEvent Î“ {âŸ¦AâŸ§}{âŸ¦BâŸ§} âŸ¦EâŸ§ âŸ¦CâŸ§ =
--     Î¼.at âŸ¦BâŸ§ âˆ˜ F-â—‡.fmap (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âˆ˜ st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦AâŸ§ âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢âŸ§â–¡ , âŸ¦EâŸ§ âŸ©

-- private
--     open âŸ¦KâŸ§ âŸ¦ğ’¯ermâŸ§
--     âŸ¦_âŸ§â‚› : âˆ€{Î“ Î”} -> Subst Term Î“ Î” -> âŸ¦ Î” âŸ§â‚“ â‡´ âŸ¦ Î“ âŸ§â‚“
--     âŸ¦ Ïƒ âŸ§â‚› = âŸ¦substâŸ§ Ïƒ

--
-- assoc-lemma : âˆ€ Î“ {A B G} (âŸ¦CâŸ§ : âŸ¦ Î“ Ë¢ âŸ§â‚“ âŠ— âŸ¦ G âŸ§â‚œ â‡´ â—‡ âŸ¦ A âŸ§â‚œ)
--         (âŸ¦DâŸ§ : âŸ¦ Î“ Ë¢ âŸ§â‚“ âŠ— âŸ¦ A âŸ§â‚œ â‡´ â—‡ âŸ¦ B âŸ§â‚œ)
--      -> Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ)
--         âˆ˜ (â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ * id)
--                            âˆ˜ st âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ
--                            âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ ,, G now Ë¢âŸ§â–¡ , âŸ¦CâŸ§ âŸ© âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id))
--         âˆ˜ st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ âˆ˜ (âŸ¦ Î“ Ë¢âŸ§â–¡ * id)
--      â‰ˆ â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âˆ˜ st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ
--      âˆ˜ âŸ¨ Ï€â‚ âˆ˜ âŸ¦ Î“ Ë¢âŸ§â–¡ * id , Î¼.at âŸ¦ A âŸ§â‚œ âˆ˜ â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)
--                          âˆ˜ st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ âˆ˜ âŸ¦ Î“ Ë¢âŸ§â–¡ * id âŸ©
-- assoc-lemma Î“ {A} {B} {G} âŸ¦CâŸ§ âŸ¦DâŸ§ {n} {âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§} =
--     begin
--         Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n
--             (â—‡-f (âŒ â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âˆ˜ â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) * id) âŒŸ
--                  âˆ˜ st âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ
--                  âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ ,, G now Ë¢âŸ§â–¡ , âŸ¦CâŸ§ âŸ© âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)) n
--         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))
--     â‰¡âŸ¨ cong! (ext Î» m â†’ ext Î» b â†’
--             F-â—‡.fmap-âˆ˜ {g = âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id} {â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) * id} {m} {b}) âŸ©
--         Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n
--             (â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âˆ˜
--                  âŒ â—‡-f (â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) * id)
--                  âˆ˜ st âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ âŒŸ
--                  âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ ,, G now Ë¢âŸ§â–¡ , âŸ¦CâŸ§ âŸ© âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)) n
--         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))
--     â‰¡âŸ¨ cong! (ext Î» m â†’ ext Î» b â†’ st-natâ‚ {D = âŸ¦ A âŸ§â‚œ} (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) {m} {b}) âŸ©
--         Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n
--             (â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âˆ˜
--                  st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ âˆ˜ â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id
--                  âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ ,, G now Ë¢âŸ§â–¡ , âŸ¦CâŸ§ âŸ© âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)) n
--         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))
--     â‰¡âŸ¨âŸ©
--         -- Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n
--         --     (â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âˆ˜
--         --          st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ âˆ˜ â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id
--         --          âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ ,, G now Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--         -- (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))
--     -- -- â‰¡âŸ¨ cong! (ext Î» m â†’ ext Î» b â†’ st-natâ‚ {D = âŸ¦ A âŸ§â‚œ} (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) {m} {b}) âŸ©
--         Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n
--             (â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)
--                     âˆ˜ st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ
--                     âˆ˜ âŸ¨ â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) âˆ˜ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                       , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                 (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))
--     â‰¡âŸ¨ cong (Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n) (F-â—‡.fmap-âˆ˜ {g = â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âˆ˜ st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ}
--                             {âŸ¨ â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) âˆ˜ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                                       , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©}{n}{st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)}) âŸ©
--         Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n
--             (â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)
--                     âˆ˜ st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ) n
--             (â—‡-f (âŸ¨ â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) âˆ˜ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                       , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                 (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))))
--     â‰¡âŸ¨ cong (Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n) (F-â—‡.fmap-âˆ˜ {g = â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)} {st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ} {n}
--                                     {â—‡-f (âŸ¨ â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) âˆ˜ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                                           , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                                           (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))})  âŸ©
--         Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n
--             (â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)) n
--             (â—‡-f (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ) n
--                 âŒ (â—‡-f (âŸ¨ â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) âˆ˜ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                       , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                       (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))) âŒŸ ))
--     â‰¡âŸ¨ cong! lemma2 âŸ©
--         Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n
--             (â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)) n
--             (â—‡-f (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ) n
--                 (st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                 (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                 (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))))))
--     â‰¡âŸ¨ sym (Î¼.nat-cond {f = âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id} {n}
--                         {â—‡-f (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ) n (st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                             (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                                         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))))}) âŸ©
--         â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--             (Î¼.at (â–¡ âŸ¦ Î“ Ë¢ âŸ§â‚“ âŠ— âŸ¦ A âŸ§â‚œ) n
--             (â—‡-f (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ) n
--             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                 (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))))))
--     â‰¡âŸ¨ cong (Î» x â†’ â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n x)
--         (st-Î¼ {âŸ¦ Î“ Ë¢ âŸ§â‚“} {âŸ¦ A âŸ§â‚œ} {n} {âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ ,
--             (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                 (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))}) âŸ©
--         â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ ,
--                 Î¼.at âŸ¦ A âŸ§â‚œ n (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                     (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))))
--     âˆ
--         where
--         lemma2 : â—‡-f (âŸ¨ â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) âˆ˜ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                       , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))
--               â‰¡ st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                     (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))))
--         lemma2 =
--             begin
--                 â—‡-f (âŸ¨ â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) âˆ˜ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                      , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))
--             â‰¡âŸ¨âŸ©
--                 â—‡-f (( â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) * id)
--                     âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                       , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))
--             â‰¡âŸ¨ F-â—‡.fmap-âˆ˜ âŸ©
--                 â—‡-f (â–¡-f (âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚›) * id) n
--                     (â—‡-f (âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                           , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                     (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))
--             â‰¡âŸ¨ cong (â—‡-f (â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id) n) (
--                 -- â‰¡âŸ¨ F-â—‡.fmap-âˆ˜ âŸ©
--                 --     â—‡-f ((âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“) * id) n
--                 --     (â—‡-f (âŸ¨ Ï€â‚ , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                 --     (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))
--                 begin
--                     â—‡-f (âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                           , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                     (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŒ âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ âŒŸ , â—‡âŸ¦GâŸ§))
--                 â‰¡âŸ¨ cong! (âŸ¦Ë¢Ë¢âŸ§ Î“ {n} {âŸ¦Î“âŸ§}) âŸ©
--                     â—‡-f (âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                           , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                     âŒ (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› n (âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ n (âŸ¦ Î“ Ë¢âŸ§ n âŸ¦Î“âŸ§)) , â—‡âŸ¦GâŸ§)) âŒŸ
--                     -- âŒ ((st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ âˆ˜ (â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› âˆ˜ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ âŸ¦ Î“ Ë¢âŸ§) * id) n (âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)) âŒŸ
--                 â‰¡âŸ¨ cong! (st-natâ‚ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› {n} {âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ n (âŸ¦ Î“ Ë¢âŸ§ n âŸ¦Î“âŸ§) , â—‡âŸ¦GâŸ§}) âŸ©
--                     â—‡-f (âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                           , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                     (â—‡-f (â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id) n (st âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n ((âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ n (âŸ¦ Î“ Ë¢âŸ§ n âŸ¦Î“âŸ§)) , â—‡âŸ¦GâŸ§)))
--                 â‰¡âŸ¨ sym F-â—‡.fmap-âˆ˜ âŸ©
--                     â—‡-f (âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                           , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ© âˆ˜ (â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id)) n
--                     (st âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n ((âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ n (âŸ¦ Î“ Ë¢âŸ§ n âŸ¦Î“âŸ§)) , â—‡âŸ¦GâŸ§))
--                 â‰¡âŸ¨âŸ©
--                     â—‡-f (âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› âˆ˜ Ï€â‚
--                         , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âˆ˜ â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id âŸ©) n
--                     (st âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n ((âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ n (âŸ¦ Î“ Ë¢âŸ§ n âŸ¦Î“âŸ§)) , â—‡âŸ¦GâŸ§))
--                 â‰¡âŸ¨ {!   !} âŸ©
--                     â—‡-f (â–¡-f âŸ¦ Î“ Ë¢ Ë¢âŸ§ * id) n
--                         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                             ( âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§
--                             , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                                 (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))))
--                 â‰¡âŸ¨ st-natâ‚ âŸ¦ Î“ Ë¢ Ë¢âŸ§ âŸ©
--                     st âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                         ( ( âŒ â–¡-f âŸ¦ Î“ Ë¢ Ë¢âŸ§ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§) âŒŸ
--                           , â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n
--                                 (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))))
--                 â‰¡âŸ¨ cong! (âŸ¦Ë¢âŸ§-comm Î“) âŸ©
--                     st âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                         ( (âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ n (âŒ âŸ¦ Î“ Ë¢âŸ§ n âŸ¦Î“âŸ§ âŒŸ)
--                           , â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n
--                                 (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))))
--                 â‰¡âŸ¨ cong! (âŸ¦Ë¢âŸ§-factor Î“) âŸ©
--                     st âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                         (((âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“) * id
--                           âˆ˜ âŸ¨ Ï€â‚ , â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âˆ˜ st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ âŸ©) n
--                            (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))
--                 âˆ
--             ) âŸ©
--                 â—‡-f (â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id) n
--                     (st âŸ¦ Î“ Ë¢ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                         (âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
--                          , â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)
--                            âˆ˜ st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ âŸ© n
--                            (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))
--             â‰¡âŸ¨ st-natâ‚ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› âŸ©
--                 st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                     ((â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * (id {â—‡ â—‡ âŸ¦ A âŸ§â‚œ})) n
--                         (âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ n (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§))
--                         , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))))
--             â‰¡âŸ¨âŸ©
--                 st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                     ( â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› n (âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ n (âŒ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§) âŒŸ))
--                     , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))))
--             â‰¡âŸ¨ cong! (âŸ¦Ë¢âŸ§-factor Î“) âŸ©
--                 st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                     ( âŒ â–¡-f âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› n (âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ n (âŸ¦ Î“ Ë¢âŸ§ n âŸ¦Î“âŸ§)) âŒŸ
--                     , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))))
--             â‰¡âŸ¨ cong! (âŸ¦Ë¢Ë¢âŸ§ Î“) âŸ©
--                 st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
--                     ( âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§
--                     , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))))
--             âˆ
                -- where
                -- bar : âˆ€ â—‡âŸ¦GâŸ§ -> â—‡-f (âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
                --       , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
                --         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))
                --     â‰¡ â—‡-f (â–¡-f âŸ¦ Î“ Ë¢ Ë¢âŸ§ * id) n
                --         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
                --             ( âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§
                --             , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
                --                 (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§)))))
                -- bar (k , a) =
                --     begin
                --         â—‡-f (âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
                --               , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
                --                 (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , (k , a)))
                --     â‰¡âŸ¨âŸ©
                --         â—‡-f (âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
                --               , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
                --                 (k , â–¹áµ-C.m k (â–¡ âŸ¦ Î“ Ë¢ âŸ§â‚“) âŸ¦ G âŸ§â‚œ n
                --                     (â–¡-â–¹áµ.at k (â–¡ âŸ¦ Î“ Ë¢ âŸ§â‚“) n
                --                         (Î´.at (âŸ¦ Î“ Ë¢ âŸ§â‚“) k (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§)) , a))
                --     â‰¡âŸ¨âŸ©
                --         k , â–¹áµ-F.fmap k ( âŸ¨ âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚
                --                         , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
                --                 (â–¹áµ-C.m k (â–¡ âŸ¦ Î“ Ë¢ âŸ§â‚“) âŸ¦ G âŸ§â‚œ n
                --                     (â–¡-â–¹áµ.at k (â–¡ âŸ¦ Î“ Ë¢ âŸ§â‚“) n
                --                         (Î´.at (âŸ¦ Î“ Ë¢ âŸ§â‚“) k (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§)) , a))
                --     â‰¡âŸ¨ {!   !} âŸ©
                --         â—‡-f (â–¡-f âŸ¦ Î“ Ë¢ Ë¢âŸ§ * id) n
                --             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n
                --                 ( âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§
                --                 , (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
                --                     (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , (k , a))))))
                --     âˆ
    -- st-â—‡ A B n (â–¡A , (k , a)) = k , â–¹áµ-C.m k (â–¡ A) B n (â–¡-â–¹áµ.at k (â–¡ A) n (Î´.at A k â–¡A) , a)

-- -- Associativity property of binding
-- bind-assoc : âˆ€ Î“ {A B G} (âŸ¦EâŸ§ : âŸ¦ Î“ âŸ§â‚“ â‡´ â—‡ âŸ¦ G âŸ§â‚œ)
--             (âŸ¦CâŸ§ : âŸ¦ Î“ Ë¢ ,, G now âŸ§â‚“ â‡´ â—‡ âŸ¦ A âŸ§â‚œ) (âŸ¦DâŸ§ : âŸ¦ Î“ Ë¢ ,, A now âŸ§â‚“ â‡´ â—‡ âŸ¦ B âŸ§â‚œ)
--           -> bindEvent Î“ âŸ¦EâŸ§
--                 (bindEvent (Î“ Ë¢ ,, G now) âŸ¦CâŸ§ (âŸ¦DâŸ§ âˆ˜ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id))
--            â‰ˆ bindEvent Î“ (bindEvent Î“ âŸ¦EâŸ§ âŸ¦CâŸ§) âŸ¦DâŸ§
-- bind-assoc Î“ {A}{B}{G} âŸ¦EâŸ§ âŸ¦CâŸ§ âŸ¦DâŸ§ {n} {âŸ¦Î“âŸ§} =
--     begin
--         bindEvent Î“ âŸ¦EâŸ§ (bindEvent (Î“ Ë¢ ,, G now) âŸ¦CâŸ§ (âŸ¦DâŸ§ âˆ˜ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id)) n âŸ¦Î“âŸ§
--     â‰¡âŸ¨âŸ©
--         Î¼.at âŸ¦ B âŸ§â‚œ n
--         (â—‡-f (bindEvent (Î“ Ë¢ ,, G now) âŸ¦CâŸ§ (âŸ¦DâŸ§ âˆ˜ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id) âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id)) n
--             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§)))
--     â‰¡âŸ¨âŸ©
--         Î¼.at âŸ¦ B âŸ§â‚œ n
--         (â—‡-f (Î¼.at âŸ¦ B âŸ§â‚œ âˆ˜ â—‡-f (âŸ¦DâŸ§ âˆ˜ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id âˆ˜ Îµ.at âŸ¦ (Î“ Ë¢ ,, G now) Ë¢ âŸ§â‚“ * id)
--                          âˆ˜ st âŸ¦ (Î“ Ë¢ ,, G now) Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ
--                          âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ ,, G now Ë¢âŸ§â–¡ âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) , âŸ¦CâŸ§ âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âŸ© ) n
--             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§)))
--     â‰¡âŸ¨ cong (Î¼.at âŸ¦ B âŸ§â‚œ n) (F-â—‡.fmap-âˆ˜ {g = Î¼.at âŸ¦ B âŸ§â‚œ} {â—‡-f (âŸ¦DâŸ§ âˆ˜ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id âˆ˜ Îµ.at âŸ¦ (Î“ Ë¢ ,, G now) Ë¢ âŸ§â‚“ * id)
--                     âˆ˜ st âŸ¦ (Î“ Ë¢ ,, G now) Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ ,, G now Ë¢âŸ§â–¡ âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) , âŸ¦CâŸ§ âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âŸ© }
--                     {n} {st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§)}) âŸ©
--         Î¼.at âŸ¦ B âŸ§â‚œ n (â—‡-f (Î¼.at âŸ¦ B âŸ§â‚œ) n
--             (â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id âˆ˜ Îµ.at âŸ¦ (Î“ Ë¢ ,, G now) Ë¢ âŸ§â‚“ * id)
--                          âˆ˜ st âŸ¦ (Î“ Ë¢ ,, G now) Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ
--                          âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ ,, G now Ë¢âŸ§â–¡ âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) , âŸ¦CâŸ§ âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âŸ© ) n
--             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§))))
--     â‰¡âŸ¨ sym (Î¼-assoc {n = n} {â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id âˆ˜ Îµ.at âŸ¦ (Î“ Ë¢ ,, G now) Ë¢ âŸ§â‚“ * id)
--                  âˆ˜ st âŸ¦ (Î“ Ë¢ ,, G now) Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ
--                  âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ ,, G now Ë¢âŸ§â–¡ âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) , âŸ¦CâŸ§ âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âŸ© ) n
--                     (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§))}) âŸ©
--         Î¼.at âŸ¦ B âŸ§â‚œ n (Î¼.at (â—‡ âŸ¦ B âŸ§â‚œ) n
--             (â—‡-f (â—‡-f (âŸ¦DâŸ§ âˆ˜ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id âˆ˜ Îµ.at âŸ¦ (Î“ Ë¢ ,, G now) Ë¢ âŸ§â‚“ * id)
--                          âˆ˜ st âŸ¦ (Î“ Ë¢ ,, G now) Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ
--                          âˆ˜ âŸ¨ âŸ¦ Î“ Ë¢ ,, G now Ë¢âŸ§â–¡ âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) , âŸ¦CâŸ§ âˆ˜ (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) âŸ© ) n
--             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§))))
--     â‰¡âŸ¨ cong (Î¼.at âŸ¦ B âŸ§â‚œ n) (assoc-lemma Î“ {A}{B}{G} âŸ¦CâŸ§ âŸ¦DâŸ§ {n} {âŸ¦Î“âŸ§ , (âŸ¦EâŸ§ n âŸ¦Î“âŸ§)}) âŸ©
--     -- â‰¡âŸ¨ cong (Î¼.at âŸ¦ B âŸ§â‚œ n) (lemma Î“ {A} {B} {G} âŸ¦CâŸ§ âŸ¦DâŸ§ {n} {(âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§)}) âŸ©
--     --     Î¼.at âŸ¦ B âŸ§â‚œ n (â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--     --         (Î¼.at (â–¡ âŸ¦ Î“ Ë¢ âŸ§â‚“ âŠ— âŸ¦ A âŸ§â‚œ) n
--     --         (â—‡-f (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ) n
--     --         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ (â—‡ âŸ¦ A âŸ§â‚œ) n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ ,
--     --             (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--     --                 (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§))))))))
--     -- â‰¡âŸ¨ cong (Î» x â†’ Î¼.at âŸ¦ B âŸ§â‚œ n (â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n x))
--     --     (st-Î¼ {âŸ¦ Î“ Ë¢ âŸ§â‚“} {âŸ¦ A âŸ§â‚œ} {n} {âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ ,
--     --         (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--     --             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§)))}) âŸ©
--     --     Î¼.at âŸ¦ B âŸ§â‚œ n (â—‡-f âŸ¦DâŸ§ n
--     --         (â—‡-f (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--     --         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ ,
--     --             Î¼.at âŸ¦ A âŸ§â‚œ n (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--     --                 (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§)))))))
--     -- â‰¡âŸ¨ cong (Î¼.at âŸ¦ B âŸ§â‚œ n) (sym (F-â—‡.fmap-âˆ˜ {g = âŸ¦DâŸ§}{Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id}{n}
--     --                 {st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ ,
--     --                     Î¼.at âŸ¦ A âŸ§â‚œ n (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--     --                         (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§))))})) âŸ©
--         Î¼.at âŸ¦ B âŸ§â‚œ n (â—‡-f (âŸ¦DâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ A âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ ,
--                 Î¼.at âŸ¦ A âŸ§â‚œ n (â—‡-f (âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                     (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , âŸ¦EâŸ§ n âŸ¦Î“âŸ§))))))
--     â‰¡âŸ¨âŸ©
--         bindEvent Î“ (bindEvent Î“ âŸ¦EâŸ§ âŸ¦CâŸ§) âŸ¦DâŸ§ n âŸ¦Î“âŸ§
--     âˆ
--                 â‰¡âŸ¨ F-â—‡.fmap-âˆ˜ âŸ©
--                     â—‡-f (âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ * id) n
--                     (â—‡-f (Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                     (â—‡-f (âŸ¨ Ï€â‚ , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                     (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))))
--                     -- ((â—‡-f (âŸ¨ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ âˆ˜ Ï€â‚ , âŸ¦CâŸ§ âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id âŸ©) n
--                 â‰¡âŸ¨ cong (â—‡-f (âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ * id) n) (sym F-â—‡.fmap-âˆ˜) âŸ©
--                     â—‡-f (âŸ¦ Î“ Ë¢ Ë¢âŸ§â–¡ * id) n
--                         ((â—‡-f (âŸ¨ Ï€â‚ , âŸ¦CâŸ§ âŸ© âˆ˜ Îµ.at âŸ¦ Î“ Ë¢ âŸ§â‚“ * id) n
--                             (st âŸ¦ Î“ Ë¢ âŸ§â‚“ âŸ¦ G âŸ§â‚œ n (âŸ¦ Î“ Ë¢âŸ§â–¡ n âŸ¦Î“âŸ§ , â—‡âŸ¦GâŸ§))))

-- bind-assoc : âˆ€ Î“ A B G (âŸ¦EâŸ§ : âŸ¦ Î“ âŸ§â‚“ â‡´ â—‡ âŸ¦ G âŸ§â‚œ)
--             (âŸ¦CâŸ§ : âŸ¦ Î“ Ë¢ ,, G now âŸ§â‚“ â‡´ â—‡ âŸ¦ A âŸ§â‚œ) (âŸ¦DâŸ§ : âŸ¦ Î“ Ë¢ ,, A now âŸ§â‚“ â‡´ â—‡ âŸ¦ B âŸ§â‚œ)
--           -> bindEvent Î“ âŸ¦EâŸ§
--                 (bindEvent (Î“ Ë¢ ,, G now) âŸ¦CâŸ§ (âŸ¦DâŸ§ âˆ˜ âŸ¦ Î“ Ë¢Ë¢â‚› ğ’¯erm âŸ§â‚› * id))
--            â‰ˆ bindEvent Î“ (bindEvent Î“ âŸ¦EâŸ§ âŸ¦CâŸ§) âŸ¦DâŸ§
-- bind-assoc Î“ A B G âŸ¦EâŸ§ âŸ¦CâŸ§ âŸ¦DâŸ§ {n} {âŸ¦Î“âŸ§} = {!   !}
